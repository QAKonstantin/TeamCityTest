{"uid":"719c026324611566","name":"Авторизация под разными ролями и проверка ссылок в футере","fullName":"tests.frontend.test_check_footer#test_e2e_check_footer_by_roles","historyId":"9f36a7653b9c32aae141b627f1dd1145","time":{"start":1711353151141,"stop":1711353151241,"duration":100},"status":"broken","statusMessage":"playwright._impl._errors.TargetClosedError: Target page, context or browser has been closed","statusTrace":"browser = <Page url='http://localhost:8111/favorite/projects'>\nuser_create = <function user_create.<locals>._user_create at 0x7f9cb85e7490>\nrole = 'AGENT_MANAGER'\n\n    @pytest.mark.parametrize(\"role\", [\n        Roles.SYSTEM_ADMIN.value,\n        Roles.PROJECT_ADMIN.value,\n        Roles.AGENT_MANAGER.value,\n    ], ids=[\"By system admin\",\n            \"By project admin\",\n            \"By agent manager\"])\n    @allure.severity(allure.severity_level.NORMAL)\n    @allure.parent_suite(\"UI тесты\")\n    @allure.suite(\"Проверка футера\")\n    @allure.sub_suite(\"Футер\")\n    @allure.title(\"Авторизация под разными ролями и проверка ссылок в футере\")\n    # @pytest.mark.ui\n    @pytest.mark.footer\n    def test_e2e_check_footer_by_roles(browser, user_create, role):\n        with allure.step(f'Создание пользователя с ролью {role}'):\n            role_user = user_create(role)\n    \n        with allure.step(f\"Авторизация под ролью {role}\"):\n            main_page = AuthLoginForm(browser)\n>           main_page.login(*role_user.creds)\n\ntests/frontend/test_check_footer.py:28: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \npages/auth_page.py:35: in login\n    self.go_to_login_page()\npages/auth_page.py:31: in go_to_login_page\n    self.actions.navigate(self.page_url)\nactions/page_actions.py:11: in navigate\n    self.page.goto(url)\n../../../.local/lib/python3.10/site-packages/playwright/sync_api/_generated.py:9327: in goto\n    self._sync(\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_page.py:484: in goto\n    return await self._main_frame.goto(**locals_to_params(locals()))\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_frame.py:149: in goto\n    await self._channel.send(\"goto\", locals_to_params(locals()))\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_connection.py:63: in send\n    return await self._connection.wrap_api_call(\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_connection.py:495: in wrap_api_call\n    return await cb()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._connection.Channel object at 0x7f9cb8aae800>\nmethod = 'goto', params = {'url': 'http://localhost:8111/login.html'}\nreturn_as_dict = False\n\n    async def inner_send(\n        self, method: str, params: Optional[Dict], return_as_dict: bool\n    ) -> Any:\n        if params is None:\n            params = {}\n        callback = self._connection._send_message_to_server(\n            self._object, method, _filter_none(params)\n        )\n        if self._connection._error:\n            error = self._connection._error\n            self._connection._error = None\n            raise error\n        done, _ = await asyncio.wait(\n            {\n                self._connection._transport.on_error_future,\n                callback.future,\n            },\n            return_when=asyncio.FIRST_COMPLETED,\n        )\n        if not callback.future.done():\n            callback.future.cancel()\n>       result = next(iter(done)).result()\nE       playwright._impl._errors.TargetClosedError: Target page, context or browser has been closed\n\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_connection.py:101: TargetClosedError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1711352987098,"stop":1711352987143,"duration":45},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1711353115944,"stop":1711353125899,"duration":9955},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"super_admin","time":{"start":1711353151125,"stop":1711353151135,"duration":10},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"user_session","time":{"start":1711353151125,"stop":1711353151125,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"user_create","time":{"start":1711353151135,"stop":1711353151135,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"broken","statusMessage":"playwright._impl._errors.TargetClosedError: Target page, context or browser has been closed","statusTrace":"browser = <Page url='http://localhost:8111/favorite/projects'>\nuser_create = <function user_create.<locals>._user_create at 0x7f9cb85e7490>\nrole = 'AGENT_MANAGER'\n\n    @pytest.mark.parametrize(\"role\", [\n        Roles.SYSTEM_ADMIN.value,\n        Roles.PROJECT_ADMIN.value,\n        Roles.AGENT_MANAGER.value,\n    ], ids=[\"By system admin\",\n            \"By project admin\",\n            \"By agent manager\"])\n    @allure.severity(allure.severity_level.NORMAL)\n    @allure.parent_suite(\"UI тесты\")\n    @allure.suite(\"Проверка футера\")\n    @allure.sub_suite(\"Футер\")\n    @allure.title(\"Авторизация под разными ролями и проверка ссылок в футере\")\n    # @pytest.mark.ui\n    @pytest.mark.footer\n    def test_e2e_check_footer_by_roles(browser, user_create, role):\n        with allure.step(f'Создание пользователя с ролью {role}'):\n            role_user = user_create(role)\n    \n        with allure.step(f\"Авторизация под ролью {role}\"):\n            main_page = AuthLoginForm(browser)\n>           main_page.login(*role_user.creds)\n\ntests/frontend/test_check_footer.py:28: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \npages/auth_page.py:35: in login\n    self.go_to_login_page()\npages/auth_page.py:31: in go_to_login_page\n    self.actions.navigate(self.page_url)\nactions/page_actions.py:11: in navigate\n    self.page.goto(url)\n../../../.local/lib/python3.10/site-packages/playwright/sync_api/_generated.py:9327: in goto\n    self._sync(\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_page.py:484: in goto\n    return await self._main_frame.goto(**locals_to_params(locals()))\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_frame.py:149: in goto\n    await self._channel.send(\"goto\", locals_to_params(locals()))\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_connection.py:63: in send\n    return await self._connection.wrap_api_call(\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_connection.py:495: in wrap_api_call\n    return await cb()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._connection.Channel object at 0x7f9cb8aae800>\nmethod = 'goto', params = {'url': 'http://localhost:8111/login.html'}\nreturn_as_dict = False\n\n    async def inner_send(\n        self, method: str, params: Optional[Dict], return_as_dict: bool\n    ) -> Any:\n        if params is None:\n            params = {}\n        callback = self._connection._send_message_to_server(\n            self._object, method, _filter_none(params)\n        )\n        if self._connection._error:\n            error = self._connection._error\n            self._connection._error = None\n            raise error\n        done, _ = await asyncio.wait(\n            {\n                self._connection._transport.on_error_future,\n                callback.future,\n            },\n            return_when=asyncio.FIRST_COMPLETED,\n        )\n        if not callback.future.done():\n            callback.future.cancel()\n>       result = next(iter(done)).result()\nE       playwright._impl._errors.TargetClosedError: Target page, context or browser has been closed\n\n../../../.local/lib/python3.10/site-packages/playwright/_impl/_connection.py:101: TargetClosedError","steps":[{"name":"Создание пользователя с ролью AGENT_MANAGER","time":{"start":1711353151141,"stop":1711353151223,"duration":82},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Авторизация под ролью AGENT_MANAGER","time":{"start":1711353151223,"stop":1711353151234,"duration":11},"status":"broken","statusMessage":"playwright._impl._errors.TargetClosedError: Target page, context or browser has been closed\n","statusTrace":"  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/tests/frontend/test_check_footer.py\", line 28, in test_e2e_check_footer_by_roles\n    main_page.login(*role_user.creds)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/pages/auth_page.py\", line 35, in login\n    self.go_to_login_page()\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/pages/auth_page.py\", line 31, in go_to_login_page\n    self.actions.navigate(self.page_url)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/actions/page_actions.py\", line 11, in navigate\n    self.page.goto(url)\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/sync_api/_generated.py\", line 9327, in goto\n    self._sync(\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_sync_base.py\", line 115, in _sync\n    return task.result()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_page.py\", line 484, in goto\n    return await self._main_frame.goto(**locals_to_params(locals()))\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_frame.py\", line 149, in goto\n    await self._channel.send(\"goto\", locals_to_params(locals()))\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 63, in send\n    return await self._connection.wrap_api_call(\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 495, in wrap_api_call\n    return await cb()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 101, in inner_send\n    result = next(iter(done)).result()\n","steps":[{"name":"Переход на страницу авторизации","time":{"start":1711353151223,"stop":1711353151234,"duration":11},"status":"broken","statusMessage":"playwright._impl._errors.TargetClosedError: Target page, context or browser has been closed\n","statusTrace":"  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/pages/auth_page.py\", line 31, in go_to_login_page\n    self.actions.navigate(self.page_url)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/actions/page_actions.py\", line 11, in navigate\n    self.page.goto(url)\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/sync_api/_generated.py\", line 9327, in goto\n    self._sync(\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_sync_base.py\", line 115, in _sync\n    return task.result()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_page.py\", line 484, in goto\n    return await self._main_frame.goto(**locals_to_params(locals()))\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_frame.py\", line 149, in goto\n    await self._channel.send(\"goto\", locals_to_params(locals()))\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 63, in send\n    return await self._connection.wrap_api_call(\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 495, in wrap_api_call\n    return await cb()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 101, in inner_send\n    result = next(iter(done)).result()\n","steps":[{"name":"Переход на URL: http://localhost:8111/login.html","time":{"start":1711353151223,"stop":1711353151233,"duration":10},"status":"broken","statusMessage":"playwright._impl._errors.TargetClosedError: Target page, context or browser has been closed\n","statusTrace":"  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/actions/page_actions.py\", line 11, in navigate\n    self.page.goto(url)\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/sync_api/_generated.py\", line 9327, in goto\n    self._sync(\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_sync_base.py\", line 115, in _sync\n    return task.result()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_page.py\", line 484, in goto\n    return await self._main_frame.goto(**locals_to_params(locals()))\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_frame.py\", line 149, in goto\n    await self._channel.send(\"goto\", locals_to_params(locals()))\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 63, in send\n    return await self._connection.wrap_api_call(\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 495, in wrap_api_call\n    return await cb()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 101, in inner_send\n    result = next(iter(done)).result()\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"4317e9faaa760938","name":"log","source":"4317e9faaa760938.txt","type":"text/plain","size":1672}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":4,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"user_create::0","time":{"start":1711353151588,"stop":1711353151607,"duration":19},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"user_session::0","time":{"start":1711353151608,"stop":1711353151609,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1711353151609,"stop":1711353151630,"duration":21},"status":"broken","statusMessage":"playwright._impl._errors.TargetClosedError: Target page, context or browser has been closed\n","statusTrace":"  File \"/home/runner/.local/lib/python3.10/site-packages/allure_commons/_allure.py\", line 221, in __call__\n    return self._fixture_function(*args, **kwargs)\n  File \"/home/runner/.local/lib/python3.10/site-packages/_pytest/fixtures.py\", line 932, in _teardown_yield_fixture\n    next(it)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/conftest.py\", line 20, in browser\n    BrowserSetup.teardown(context, browser, playwright)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/utils/browser_setup.py\", line 25, in teardown\n    context.tracing.stop(path=trace_file)\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/sync_api/_generated.py\", line 15606, in stop\n    return mapping.from_maybe_impl(self._sync(self._impl_obj.stop(path=path)))\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_sync_base.py\", line 115, in _sync\n    return task.result()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_tracing.py\", line 74, in stop\n    await self._connection.wrap_api_call(_inner, True)\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 495, in wrap_api_call\n    return await cb()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_tracing.py\", line 71, in _inner\n    await self._do_stop_chunk(path)\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_tracing.py\", line 91, in _do_stop_chunk\n    result = await self._channel.send_return_as_dict(\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 68, in send_return_as_dict\n    return await self._connection.wrap_api_call(\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 490, in wrap_api_call\n    return await cb()\n  File \"/home/runner/.local/lib/python3.10/site-packages/playwright/_impl/_connection.py\", line 101, in inner_send\n    result = next(iter(done)).result()\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"labels":[{"name":"severity","value":"normal"},{"name":"subSuite","value":"Футер"},{"name":"suite","value":"Проверка футера"},{"name":"parentSuite","value":"UI тесты"},{"name":"tag","value":"footer"},{"name":"host","value":"fv-az1380-989"},{"name":"thread","value":"7813-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.frontend.test_check_footer"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"browser","value":"'firefox'"},{"name":"role","value":"'AGENT_MANAGER'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":2,"skipped":0,"passed":8,"unknown":0,"total":10},"items":[{"uid":"8387e87c7ba90491","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/112//#testresult/8387e87c7ba90491","status":"broken","statusDetails":"ValueError: Unexpected status code: 403, expected: 204","time":{"start":1711352559978,"stop":1711352625041,"duration":65063}},{"uid":"51817f606eeb1db7","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/111//#testresult/51817f606eeb1db7","status":"passed","time":{"start":1711351828475,"stop":1711351868857,"duration":40382}},{"uid":"18e83b38133e8ef3","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/110//#testresult/18e83b38133e8ef3","status":"passed","time":{"start":1711351097672,"stop":1711351119055,"duration":21383}},{"uid":"1e69a43ebb5e8be4","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/109//#testresult/1e69a43ebb5e8be4","status":"passed","time":{"start":1711349231614,"stop":1711349258526,"duration":26912}},{"uid":"25d9b31407f42309","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/107//#testresult/25d9b31407f42309","status":"passed","time":{"start":1711348567703,"stop":1711348596944,"duration":29241}},{"uid":"5ef986a929bc3b8c","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/106//#testresult/5ef986a929bc3b8c","status":"passed","time":{"start":1711305546930,"stop":1711305571067,"duration":24137}},{"uid":"85e9b6c29b62309","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/105//#testresult/85e9b6c29b62309","status":"passed","time":{"start":1711304790432,"stop":1711304821658,"duration":31226}},{"uid":"768f190258415a79","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/104//#testresult/768f190258415a79","status":"passed","time":{"start":1711303864081,"stop":1711303890610,"duration":26529}},{"uid":"11236db64b7eb046","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/103//#testresult/11236db64b7eb046","status":"passed","time":{"start":1711303094161,"stop":1711303115598,"duration":21437}}]},"tags":["footer"]},"source":"719c026324611566.json","parameterValues":["'firefox'","'AGENT_MANAGER'"]}