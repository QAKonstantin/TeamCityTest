{"uid":"2e130d26e2dc382c","name":"Проверка создания билд конфигурации","fullName":"tests.backend.test_create_build_conf.TestBuildConfCreate#test_positive_creating_build_conf","historyId":"fcf25fb315e132db6330801e569de04f","time":{"start":1711468566777,"stop":1711468566794,"duration":17},"description":"Проверяется создание билд конфигурации","descriptionHtml":"<p>Проверяется создание билд конфигурации</p>\n","status":"broken","statusMessage":"ValueError: Unexpected status code: 400, expected: 200","statusTrace":"self = <test_create_build_conf.TestBuildConfCreate object at 0x7f7f86f31480>\nproject_data = <function project_data.<locals>._create_project_data at 0x7f7f86fd4af0>\nbuild_conf_data = <function build_conf_data.<locals>._create_build_conf_data at 0x7f7f86fd4b80>\nuser_create = <function user_create.<locals>._user_create at 0x7f7f86fd4c10>\nrole = 'AGENT_MANAGER'\n\n    @pytest.mark.parametrize(\"role\", [\n        Roles.SYSTEM_ADMIN.value,\n        Roles.PROJECT_ADMIN.value,\n        Roles.AGENT_MANAGER.value,\n    ], ids=[\"By system admin\",\n            \"By project admin\",\n            \"By agent manager\"])\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.parent_suite(\"API тесты\")\n    @allure.suite(\"Управление билд конфигурациями\")\n    @allure.sub_suite(\"Создание билд конфигурации\")\n    @allure.title('Проверка создания билд конфигурации')\n    @allure.description('Проверяется создание билд конфигурации')\n    @pytest.mark.build_conf\n    def test_positive_creating_build_conf(self, project_data, build_conf_data, user_create, role):\n        with allure.step('Подготовка данных для создания проекта и билд конфигурации'):\n            project_data_1 = project_data()\n            build_conf_data_1 = build_conf_data(project_data_1.id)\n    \n        with allure.step(f'Создание и авторизация пользователя с ролью {role}'):\n>           role_user = user_create(role)\n\ntests/backend/test_create_build_conf.py:33: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nconftest.py:66: in _user_create\n    super_admin.api_manager.user_api.create_user(user_data)\napi/user_api.py:9: in create_user\n    return self.send_request(\"POST\", \"/app/rest/users\", data=user_data)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <api.user_api.UserApi object at 0x7f7f86fc4c40>, method = 'POST'\nendpoint = '/app/rest/users'\ndata = {'email': 'parkertravis@example.net', 'password': 'n4FthiwCIom', 'roles': {'role': [{'roleId': 'AGENT_MANAGER', 'scope': 'g'}]}, 'username': 'admit'}\nexpected_status = <HTTPStatus.OK: 200>, need_logging = True\nneed_verify_status = True\n\n    def send_request(self, method, endpoint, data=None, expected_status=HTTPStatus.OK, need_logging=True,\n                     need_verify_status=True):\n        \"\"\"\n        Врапер для запросов. Позволяет прикручивать дополнительную логику\n        :param method: Метод запроса\n        :param endpoint: Ендпоинт для склейки с BASE_URL\n        :param data: Тело запроса. По умолчанию пустое, чтобы пропускало no-content запросы\n        :param expected_status: Ожидаемый статус код\n        :param need_logging: Флаг для логирования. По умолчанию = True\n        :param need_verify_status: Флаг для проверки статус кода в ответе. По умолчанию = True\n        :return: Возвращает объект ответа\n        \"\"\"\n        url = f\"{self.base_url}{endpoint}\"\n        response = self.session.request(method=method, url=url, json=data)\n        if need_logging:\n            self.log_request_and_response(response, expected_status, need_verify_status)\n        if need_verify_status:\n            if response.status_code != expected_status:\n>               raise ValueError(f\"Unexpected status code: {response.status_code}, expected: {expected_status}\")\nE               ValueError: Unexpected status code: 400, expected: 200\n\ncustom_requester/custom_requester.py:34: ValueError","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1711468566710,"stop":1711468566762,"duration":52},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"user_session","time":{"start":1711468566762,"stop":1711468566763,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"super_admin","time":{"start":1711468566763,"stop":1711468566775,"duration":12},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_data","time":{"start":1711468566775,"stop":1711468566775,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"build_conf_data","time":{"start":1711468566775,"stop":1711468566775,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"user_create","time":{"start":1711468566776,"stop":1711468566776,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Проверяется создание билд конфигурации","status":"broken","statusMessage":"ValueError: Unexpected status code: 400, expected: 200","statusTrace":"self = <test_create_build_conf.TestBuildConfCreate object at 0x7f7f86f31480>\nproject_data = <function project_data.<locals>._create_project_data at 0x7f7f86fd4af0>\nbuild_conf_data = <function build_conf_data.<locals>._create_build_conf_data at 0x7f7f86fd4b80>\nuser_create = <function user_create.<locals>._user_create at 0x7f7f86fd4c10>\nrole = 'AGENT_MANAGER'\n\n    @pytest.mark.parametrize(\"role\", [\n        Roles.SYSTEM_ADMIN.value,\n        Roles.PROJECT_ADMIN.value,\n        Roles.AGENT_MANAGER.value,\n    ], ids=[\"By system admin\",\n            \"By project admin\",\n            \"By agent manager\"])\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.parent_suite(\"API тесты\")\n    @allure.suite(\"Управление билд конфигурациями\")\n    @allure.sub_suite(\"Создание билд конфигурации\")\n    @allure.title('Проверка создания билд конфигурации')\n    @allure.description('Проверяется создание билд конфигурации')\n    @pytest.mark.build_conf\n    def test_positive_creating_build_conf(self, project_data, build_conf_data, user_create, role):\n        with allure.step('Подготовка данных для создания проекта и билд конфигурации'):\n            project_data_1 = project_data()\n            build_conf_data_1 = build_conf_data(project_data_1.id)\n    \n        with allure.step(f'Создание и авторизация пользователя с ролью {role}'):\n>           role_user = user_create(role)\n\ntests/backend/test_create_build_conf.py:33: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nconftest.py:66: in _user_create\n    super_admin.api_manager.user_api.create_user(user_data)\napi/user_api.py:9: in create_user\n    return self.send_request(\"POST\", \"/app/rest/users\", data=user_data)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <api.user_api.UserApi object at 0x7f7f86fc4c40>, method = 'POST'\nendpoint = '/app/rest/users'\ndata = {'email': 'parkertravis@example.net', 'password': 'n4FthiwCIom', 'roles': {'role': [{'roleId': 'AGENT_MANAGER', 'scope': 'g'}]}, 'username': 'admit'}\nexpected_status = <HTTPStatus.OK: 200>, need_logging = True\nneed_verify_status = True\n\n    def send_request(self, method, endpoint, data=None, expected_status=HTTPStatus.OK, need_logging=True,\n                     need_verify_status=True):\n        \"\"\"\n        Врапер для запросов. Позволяет прикручивать дополнительную логику\n        :param method: Метод запроса\n        :param endpoint: Ендпоинт для склейки с BASE_URL\n        :param data: Тело запроса. По умолчанию пустое, чтобы пропускало no-content запросы\n        :param expected_status: Ожидаемый статус код\n        :param need_logging: Флаг для логирования. По умолчанию = True\n        :param need_verify_status: Флаг для проверки статус кода в ответе. По умолчанию = True\n        :return: Возвращает объект ответа\n        \"\"\"\n        url = f\"{self.base_url}{endpoint}\"\n        response = self.session.request(method=method, url=url, json=data)\n        if need_logging:\n            self.log_request_and_response(response, expected_status, need_verify_status)\n        if need_verify_status:\n            if response.status_code != expected_status:\n>               raise ValueError(f\"Unexpected status code: {response.status_code}, expected: {expected_status}\")\nE               ValueError: Unexpected status code: 400, expected: 200\n\ncustom_requester/custom_requester.py:34: ValueError","steps":[{"name":"Подготовка данных для создания проекта и билд конфигурации","time":{"start":1711468566777,"stop":1711468566777,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Создание и авторизация пользователя с ролью AGENT_MANAGER","time":{"start":1711468566777,"stop":1711468566790,"duration":13},"status":"broken","statusMessage":"ValueError: Unexpected status code: 400, expected: 200\n","statusTrace":"  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/tests/backend/test_create_build_conf.py\", line 33, in test_positive_creating_build_conf\n    role_user = user_create(role)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/conftest.py\", line 66, in _user_create\n    super_admin.api_manager.user_api.create_user(user_data)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/api/user_api.py\", line 9, in create_user\n    return self.send_request(\"POST\", \"/app/rest/users\", data=user_data)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/custom_requester/custom_requester.py\", line 34, in send_request\n    raise ValueError(f\"Unexpected status code: {response.status_code}, expected: {expected_status}\")\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"cef61dd3e139cc9","name":"log","source":"cef61dd3e139cc9.txt","type":"text/plain","size":4798}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":2,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"user_create::0","time":{"start":1711468566867,"stop":1711468566867,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"build_conf_data::0","time":{"start":1711468566868,"stop":1711468566919,"duration":51},"status":"broken","statusMessage":"ValueError: Билд конфигурации с id YVKCZRsoJht не был создан\n","statusTrace":"  File \"/home/runner/.local/lib/python3.10/site-packages/allure_commons/_allure.py\", line 221, in __call__\n    return self._fixture_function(*args, **kwargs)\n  File \"/home/runner/.local/lib/python3.10/site-packages/_pytest/fixtures.py\", line 932, in _teardown_yield_fixture\n    next(it)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/conftest.py\", line 106, in build_conf_data\n    super_admin.api_manager.build_conf_api.clean_up_build_conf(build_conf_id)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/api/build_conf_api.py\", line 31, in clean_up_build_conf\n    raise ValueError(f\"Билд конфигурации с id {create_build_id} не был создан\")\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"project_data::0","time":{"start":1711468566919,"stop":1711468566970,"duration":51},"status":"broken","statusMessage":"ValueError: Проект с id CCnCQqCzWZW не был создан\n","statusTrace":"  File \"/home/runner/.local/lib/python3.10/site-packages/allure_commons/_allure.py\", line 221, in __call__\n    return self._fixture_function(*args, **kwargs)\n  File \"/home/runner/.local/lib/python3.10/site-packages/_pytest/fixtures.py\", line 932, in _teardown_yield_fixture\n    next(it)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/conftest.py\", line 90, in project_data\n    super_admin.api_manager.project_api.clean_up_project(project_id)\n  File \"/home/runner/work/TeamCity_Test/TeamCity_Test/api/project_api.py\", line 30, in clean_up_project\n    raise ValueError(f\"Проект с id {created_project_id} не был создан\")\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"user_session::0","time":{"start":1711468566971,"stop":1711468566972,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"subSuite","value":"Создание билд конфигурации"},{"name":"suite","value":"Управление билд конфигурациями"},{"name":"parentSuite","value":"API тесты"},{"name":"severity","value":"critical"},{"name":"tag","value":"build_conf"},{"name":"host","value":"fv-az735-601"},{"name":"thread","value":"7773-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.backend.test_create_build_conf"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"role","value":"'AGENT_MANAGER'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":1,"skipped":0,"passed":1,"unknown":0,"total":2},"items":[{"uid":"3508cf2d85e67773","reportUrl":"https://QAKonstantin.github.io/TeamCity_Test/140//#testresult/3508cf2d85e67773","status":"passed","time":{"start":1711467854765,"stop":1711467856133,"duration":1368}}]},"tags":["build_conf"]},"source":"2e130d26e2dc382c.json","parameterValues":["'AGENT_MANAGER'"]}